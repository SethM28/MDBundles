<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MDBundles Admin Portal</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #101820;
      color: #fff;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #00d4ff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #555;
      padding: 10px;
      text-align: left;
    }
    th {
      background: #00d4ff;
      color: #000;
    }
    button {
      background: #00ffb3;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 4px;
    }
    button:hover {
      background: #00cc8a;
    }
  </style>
</head>
<body>
  <h2>MDBundles Admin Portal</h2>

  <h3>Pending User Approvals</h3>
  <table id="usersTable">
    <tr><th>Email</th><th>Name</th><th>Action</th></tr>
  </table>

  <h3>Recent Orders</h3>
  <table id="ordersTable">
    <tr><th>ID</th><th>Email</th><th>Network</th><th>Bundle</th><th>Status</th><th>Time</th></tr>
  </table>

  <script>
    async function fetchData() {
      const usersRes = await fetch("https://mdbundles-server.onrender.com/api/users");
      const ordersRes = await fetch("https://mdbundles-server.onrender.com/api/orders");
      const users = await usersRes.json();
      const orders = await ordersRes.json();

      const usersTable = document.getElementById("usersTable");
      usersTable.innerHTML = "<tr><th>Email</th><th>Name</th><th>Action</th></tr>";
      users.filter(u => !u.approved).forEach(u => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${u.email}</td><td>${u.name}</td>
        <td><button onclick="approveUser('${u.email}')">Approve</button></td>`;
        usersTable.appendChild(row);
      });

      const ordersTable = document.getElementById("ordersTable");
      ordersTable.innerHTML = "<tr><th>ID</th><th>Email</th><th>Network</th><th>Bundle</th><th>Status</th><th>Time</th></tr>";
      orders.forEach(o => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${o.id}</td><td>${o.email}</td><td>${o.network}</td><td>${o.bundle}</td><td>${o.status}</td><td>${new Date(o.time).toLocaleString()}</td>`;
        ordersTable.appendChild(row);
      });
    }

    async function approveUser(email) {
      await fetch("https://mdbundles-server.onrender.com/admin/approve", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email })
      });
      alert("User approved!");
      fetchData();
    }

    fetchData();
    setInterval(fetchData, 30000); // auto refresh every 30 seconds
  </script>
</body>
</html>
